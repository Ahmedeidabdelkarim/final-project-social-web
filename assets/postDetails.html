<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="../node_modules/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="./main.js"></script>
    <link rel="stylesheet" href="./style.css">
    <style>
        #comment-input:focus{
            border: none;
            outline: none;
        }
    </style>

    
</head>

<body>

    <!--modal for add post-->
    <div class="modal fade" id="addPostModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Post</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Title</label>
                            <input type="text" class="form-control" id="title" value="">
                        </div>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">body</label>
                            <textarea id="body"
                                style="display: block;border: 1px solid gray; width: 100%; height: 100px;"
                                class="form-control" placeholder="Add Post Body"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Add Image</label>
                            <input type="file" class="form-control" id="image" value="">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="logBtn" type="button" class="btn btn-primary" onclick="createNewPostClicked()">Add
                        Post</button>
                </div>
            </div>
        </div>
    </div>
    <!--end modal for add post-->


    <!--modal for login-->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Login</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">UserName:</label>
                            <input type="text" class="form-control" id="userName" value="A7med2001">
                        </div>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">Password:</label>
                            <input type="password" class="form-control" id="password" value="123456">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="logBtn" type="button" class="btn btn-primary" onclick="loginBtnClicked()">Login</button>
                </div>
            </div>
        </div>
    </div>
    <!--end modal for login-->


    <!--start modal for Register-->
    <div class="modal fade" id="RegisterModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Register New User</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Name:</label>
                            <input type="text" class="form-control" id="registerName" value="">
                        </div>

                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">Image Profile:</label>
                            <input type="file" class="form-control" id="registerImg" value="">
                        </div>

                        <div class="mb-3">
                            <label for="recipient-name" class="col-form-label">userName:</label>
                            <input type="text" class="form-control" id="registerUserName" value="">
                        </div>
                        <div class="mb-3">
                            <label for="message-text" class="col-form-label">Password:</label>
                            <input type="password" class="form-control" id="registerPassword" value="">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="logBtn" type="button" class="btn btn-primary"
                        onclick="registerBtnClicked()">Register</button>
                </div>
            </div>
        </div>
    </div>

    <!--end modal for register-->
    <div class="container">
        <div class="navbar">
            <div class="links">
                <ul>
                    <li class="logo"><a href="../index.html">Social Web</a></li>
                    <li><a href="../index.html">Home</a></li>
                    <li><a style="cursor: pointer;" onclick="profileClicked()">Profile</a></li>
                </ul>
            </div>
            <div class="buttons">

                <div id="newUser">
                    <button data-bs-toggle="modal" data-bs-target="#loginModal" id="Login">login</button>
                    <button id="Register" data-bs-toggle="modal" data-bs-target="#RegisterModal">Register</button>
                </div>
                <div id="logoutBtn">
                    <div id="userInfo" style="text-align: center;line-height: 10px; display: flex;align-items: center;">
                        <img id="PImge"
                            style="width: 35px; height: 35px; border-radius: 50%;margin-right: 7px;object-fit: fill; "
                            src="images/my.jpeg" alt="">
                        <span id="usname">Ahmed</span>
                    </div>

                    <button id="logout" onclick="logout()">Logout</button>

                </div>

            </div>
            <div class="phone">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>


            <div>
                <span id="username-span"
                style="margin-bottom: 20px;display: block;font-weight: bold;margin-left: 10px;">@A7med2001</span>

                <div id="postContent" class="content shadow my-2">
                    <!-- <div class="nav">
                        <img src="imgs/download.png" class="profile" alt="">
                        <h6>@yarhmm</h6>
                    </div> -->
                    
                    <!-- <div class="contentText">
                        <div class="img">
                            <img style="max-height: 535px;" src="imgs/nature.webp" alt="">
                        </div>
                        <p style="color: gray;">2 min ago</p>
                        <h3>special title treatement</h3>
                        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Ut, minima!</p>
                        <hr>
                        <div class="comment">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-pen" viewBox="0 0 16 16">
                                <path
                                    d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001m-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708z" />
                            </svg>
                            <p>(3) comments</p>
    
                            <span id="post-tags-${post.id}">
                                <button class="btn btn-sm rounded-5"
                                    style="background-color:gray;color:white;">policy</button>
    
                                <button class="btn btn-sm rounded-5"
                                    style="background-color:gray;color:white;">policy</button>
    
                                <button class="btn btn-sm rounded-5"
                                    style="background-color:gray;color:white;">policy</button>
                            </span> 
    
                            
    
                        </div>

                        <hr>

                    
                    </div> -->

                    <div class="comments" style="padding: 7px;background-color: rgb(243, 236, 226);">
                    <div class="userInfo">
                        <img style="width: 40px;height: 40px;border-radius: 50%;" src="images/my.jpeg" alt="">
                        <span style="margin-left: 10px;">username</span>
                    </div>

                    <div class="userBody">
                        Lorem ipsum dolor sit amet consectetur adipisicing elit. Et tempore sequi iusto quam molestias exercitationem vero repudiandae quis accusantium obcaecati.
                    </div>
                    </div>

                    <!-- <div class="input-group mb-3" style="width: 100%; display: flex;flex-wrap: nowrap;">
                    <input id="comment-input" type="text" placeholder="add your comment here" class="form-control">
                    <button class="btn btn-outline-primary" type="button" style="border-radius: 0px 7px 7px 0px;" onclick="createCommentClicked()">send</button>
                    </div> -->
                
                </div>
            
            </div>

    </div>

        <div class="fade show" id="liveAlertPlaceholder" style="position: fixed;z-index: 5;width: 60%; bottom: 0;right: 0;">
        </div>



    <script>
        setUI();

        let urlParams = new URLSearchParams(window.location.search);
        let id = urlParams.get("postId")
        function getPost() {
            axios.get(`https://tarmeezacademy.com/api/v1/posts/${id}`)
                .then((response) => {
                    let post = response.data.data;
                    let comments = post.comments;
                    let author = post.author;

                    let commentsContent=''
                    for (comment of comments) {
                        commentsContent+=`
                            <div class="comments" style="padding: 15px 7px;background-color: rgb(243, 236, 226);">
                            <div class="userInfo">
                                <img style="width: 40px;height: 40px;border-radius: 50%;" src="${comment.author.profile_image}" alt="">
                                <span style="margin-left: 10px;">${comment.author.username}</span>

                                
                            </div>
        
                            <div class="userBody">${comment.body}
                            </div>
                            </div>
                                `;
                    }

                    let userName = document.getElementById("username-span");
                    userName.textContent = `${author.name} Post`;
                    postTitle=""
                    if(post.title!=null){
                        postTitle=post.title
                    }
                    let content = `<div id="postContent" class="content shadow my-2">
                    <div style="display:flex;align-items:center;cursor:pointer" onclick="userClicked(${author.id})">
                        <img src="${author.profile_image}" class="profile" alt="">
                        <h6 style="margin-left:5px">${author.name}</h6>
                    </div>
                <div class="contentText">
                    <div class="img">
                        <img style="max-height: 535px;" src="${post.image}" alt="">
                    </div>
                    <p style="color: gray;">${post.created_at}</p>
                    <h3>${postTitle}</h3>
                    <p>${post.body}</p>
                    <hr>
                    <div class="comment">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-pen" viewBox="0 0 16 16">
                            <path
                                d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001m-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708z" />
                        </svg>
                        <p>(${post.comments_count}) comments</p>


                    </div>
                    <hr>
                </div>
                
                
                ${commentsContent}

                <div class="input-group mb-3" style="width: 100%; display: flex;flex-wrap: nowrap;">
                    <input id="comment-input" type="text" placeholder="add your comment here" class="form-control">
                    <button class="btn btn-outline-primary" type="button" style="border-radius: 0px 7px 7px 0px;" onclick="createCommentClicked()">send</button>
                </div>
                
                

            </div>`;    
                        
                document.getElementById("postContent").innerHTML=content;

                })


        }
        getPost();

        let token=localStorage.getItem("token");
        let addComment=document.querySelector(".input-group");
        if(token==null){
            addComment.style.setProperty("display","none","important")
        }else{
            addComment.style.setProperty("display","flex","important")

        }    

        function createCommentClicked(){
            let commentBody=document.getElementById("comment-input").value;
    
            let token=localStorage.getItem("token")
    
            let commentContent={
                "body":commentBody  
            }
    
            axios.post(`https://tarmeezacademy.com/api/v1/posts/${id}/comments`,commentContent,{headers:{
                "authorization":`Bearer ${token}`
            }})
            .then(response=>{
                //console.log(response);
                getPost();
                showAlert("comment added successfully!","success")
            }).catch((err)=>{
                console.log(`${err.response.data.message}`);
                showAlert(`${err.response.data.message}`,"danger")
            })
        }    
    




    </script>
</body>

</html>